name: azure-native-static-website-yaml
runtime: yaml
description: An example that deploys all of the resources for a static website on Azure.

#### Steps:
# [1] Create a resource group.
# [2] Create a blob storage account.
# [3] Configure the storage account as a website.

resources:
  # [1] Create a resource group.
  resourcegroup:
    type: azure-native:resources:ResourceGroup

  # [2] Create a blob storage account.
  storageaccount:
    type: azure-native:storage:StorageAccount
    properties:
      resourceGroupName: ${staticsitegroup.name}
      kind: "StorageV2"
      sku: { name: "Standard_LRS" }

  # [3] Configure the storage account as a website.
  staticwebsite:
    type: azure-native:storage:StorageAccountStaticWebsite
    properties:
      resourceGroupName: ${resourcegroup.name}
      accountName: ${storageaccount.name}
      indexDocument: index.html
      error404Document: 404.html

  # Upload the website files
  index.html:
    type: azure-native:storage:Blob
    properties:
      resourceGroupName: ${resourcegroup.name}
      accountName: ${storageaccount.name}
      containerName: ${staticwebsite.containerName}
      contentType: text/html
      type: "Block"
      source:
        Fn::FileAsset: ./www/index.html
  404.html:
    type: azure-native:storage:Blob
    properties:
      resourceGroupName: ${resourcegroup.name}
      accountName: ${storageaccount.name}
      containerName: ${staticwebsite.containerName}
      contentType: text/html
      type: "Block"
      source:
        Fn::FileAsset: ./wwwroot/404.html

# Export the URL of the website.
outputs:
  staticEndpoint: ${storageaccount.primaryEndpoints.web}
