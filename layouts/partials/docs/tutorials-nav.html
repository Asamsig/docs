<nav class="main-nav">
    {{ if hasPrefix .RelPermalink "/tutorials/" }}
        {{/* Render a top-level menu for our major docs sections */}}
        {{ $toc_page := . }}
        {{ $toc_sections := slice "Tutorials by cloud provider" "Tutorials by topic" "All tutorials" }}
        {{ $toc_menus := dict "Tutorials by cloud provider" .Site.Data.tutorials.providers "Tutorials by topic" .Site.Data.tutorials.topics }}

        {{ range $index, $element := $toc_sections }}
            {{ $sidenav_selected := "" }}
            {{ $toc_name := . }}
            {{ $toc_menu := (index $toc_menus $toc_name) }}

            {{ $toc_section_link := "" }}
            {{ range $toc_menu }}
                {{ if (eq .Name "Overview") }}
                    {{ $toc_section_link = .URL }}
                {{ end }}
            {{ end }}

            {{ if (eq $.Page.RelPermalink $toc_section_link) }}
                {{ $sidenav_selected = "active" }}
            {{ end }}

            {{ $toggle_class := "toggle" }}
            {{ if or (hasPrefix $.Page.RelPermalink $toc_section_link) (eq $toc_name "Clouds") }}
                {{ $toggle_class = "toggleVisible " }}
            {{ end }}
            {{ if eq $.Page.RelPermalink $toc_section_link }}
                {{ $sidenav_selected = "active" }}
            {{ end }}
            <div id="toc-menu-{{ $toc_name }}" class="{{ $sidenav_selected }} text-black no-anchor toc-header toggle-topLevel {{ $toggle_class }}" id="{{ $toc_name | urlize }}-toc-header">
                <a href="{{ $toc_section_link }}">{{ $toc_name }}</a>
                {{ if and ($toc_section_link) (ne $toc_name "Get started") }}
                    <span class="toggleButton-topLevel down">
                        <div class="icon icon-14-14 keyboard-arrow-down-gray-14-14"></div>
                    </span>
                    <span class="toggleButton-topLevel right">
                        <div class="icon icon-14-14 keyboard-arrow-right-gray"></div>
                    </span>
                {{ end }}
            </div>

            <div class="top-level-container">
                {{ template "toc-tutorials" (dict "page" $toc_page "menu" $toc_menu) }}
            </div>
        {{ end }}
    {{ end }}

    {{ define "toc-tutorials" }}
        {{ $page := .page }}

        {{ range .menu }}
                {{ $toggle_state := "toggle" }}
                {{ $filepath := .URL }}
                <ul id="toc-expandable-menu{{ replace $filepath "/" "-" }}" class="{{ $toggle_state }}">
                    <ul class="collapsed">
                        <li class="sidenav-topic">
                                <a href="{{ .URL }}" data-track="toc-{{ .shortname | urlize }}">{{ .shortname }} tutorials</a>
                            {{ if .HasChildren }}
                                <span class="toggleButton">
                                    <div class="icon icon-14-14 keyboard-arrow-right-gray"></div>
                                </span>
                            {{ end }}
                        </li>
                    </ul>
                    <ul class="expanded">
                        <li class="sidenav-topic">
                            <a href="{{ .URL }}" data-track="toc-{{ .shortname | urlize }}">{{ .shortname }} tutorials</a>
                            {{ if .HasChildren }}
                                <span class="toggleButton">
                                    <div class="icon icon-14-14 keyboard-arrow-down-gray-14-14"></div>
                                </span>
                            {{ end }}
                        </li>
                        {{ if .HasChildren }}
                            <div class="sidenav-subsection">
                                {{ template "toc" (dict "page" $page "menu" .Children) }}
                            </div>
                        {{ end }}
                    </ul>
                </ul>
        {{ end }}
    {{ end }}
</nav>
